from typing import Union
from fastapi import FastAPI, Request, Response, UploadFile, File
from fastapi.middleware.cors import CORSMiddleware
from model_api import model_predictions
import asyncio
from io import StringIO


app = FastAPI()

app.add_middleware(
    CORSMiddleware,
    allow_origins = ['*'], #Allow all origins
    allow_credentials=True,
    allow_methods = ['*'],
    allow_headers=['*']
)

@app.get("/")
async def read_root():
    return {"Hello":"World"}

@app.get("/single_response/{total_count}")
async def return_single_response(total_count):
    results = model_predictions.single_predictions(total_count)
    return results

@app.post("/bulk_response/{datatype}") #get the type of data from filename
async def upload(datatype, file: UploadFile = File(...)):
    datatype = datatype
    data = {}
    file_bytes = file.file.read()
    buffer = StringIO(file_bytes('utf-8'))